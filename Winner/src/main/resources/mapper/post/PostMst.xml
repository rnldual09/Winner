<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.Winner.mapper.PostMapper">
	
	<!-- 이미지 BLOB 사용하기 위해 반드시 필요함 -->
	<resultMap id="postList" type="HashMap">
		<result property="postSeq" column="POST_SEQ" />
		<result property="usrId" column="USR_ID" />
		<result property="openYn" column="OPEN_YN" />
		<result property="postTit" column="POST_TIT" />
		<result property="postCont" column="POST_CONT" />
		<result property="postArea1" column="POST_AREA1" />
		<result property="postArea2" column="POST_AREA2" />
		<result property="hashTag" column="HASH_TAG" />
		<result property="perYn" column="PER_YN" />
		<result property="teamYn" column="TEAM_YN" />
		<result property="teamMinCnt" column="TEAM_MIN_CNT" />
		<result property="teamMaxCnt" column="TEAM_MAX_CNT" />
		<result property="endDt" column="END_DT" />
		<result property="endYn" column="END_YN" />
		<result property="goodYn" column="GOOD_YN" />
		<result property="profileExt" column="PROFILE_EXT" />
		<result property="profile" column="PROFILE" jdbcType="BLOB"
			javaType="_byte[]" />
	</resultMap>
	
	<select id="selPostList" resultMap="postList" parameterType="Map">
		SELECT m.POST_SEQ, m.USR_ID, m.OPEN_YN, m.POST_TIT, m.POST_CONT, m.POST_AREA1, m.POST_AREA2
			, m.HASH_TAG, m.PER_YN, m.TEAM_YN, m.TEAM_MIN_CNT, m.TEAM_MAX_CNT
			, DATE_FORMAT(STR_TO_DATE(m.END_DT,'%Y%m%d'),'%Y.%m.%d') END_DT, m.END_YN
			, (SELECT CASE COUNT(*) WHEN 0 THEN 'N' ELSE 'Y' END FROM POSTGOOD s WHERE s.USR_ID = #{sessionId}) GOOD_YN
			, u.PROFILE, u.PROFILE_EXT
		FROM POSTMST m
			LEFT OUTER JOIN USRMST u
				ON(m.USR_ID = u.USR_ID)
		WHERE m.END_YN = 'N'
	</select>
	
	<select id="selPostImgList" resultType="CustomMap" parameterType="int">
		SELECT POST_SEQ, IMG_SEQ, ORI_FILE, SVR_FILE
		FROM POSTIMG
		WHERE POST_SEQ = #{postSeq}
	</select>
	
	<select id="postGoodCnt" resultType="int" parameterType="int">
		SELECT COUNT(*)
		FROM POSTGOOD
		WHERE POST_SEQ = #{postSeq}
	</select>
	
</mapper>